<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fantasy Life League</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Space+Mono:ital,wght@0,400;0,700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --neon-cyan: #00fff0;
      --neon-cyan-dim: #00b8aa;
      --electric-purple: #bf00ff;
      --neon-pink: #ff00aa;
      --neon-green: #00ff66;
      --neon-yellow: #ffff00;
      --neon-orange: #ff6600;
      --bg-darkest: #0a0a0f;
      --bg-dark: #0f0f1a;
      --bg-card: #14142a;
      --bg-card-hover: #1a1a3a;
      --bg-elevated: #1e1e3f;
      --text-primary: #ffffff;
      --text-secondary: #a0a0c0;
      --text-muted: #606080;
      --gradient-primary: linear-gradient(135deg, var(--neon-cyan), var(--electric-purple));
      --gradient-success: linear-gradient(135deg, var(--neon-green), var(--neon-cyan));
      --font-display: 'Orbitron', sans-serif;
      --font-body: 'Rajdhani', sans-serif;
      --font-mono: 'Space Mono', monospace;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background: var(--bg-darkest);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(0, 255, 240, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(191, 0, 255, 0.08) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(rgba(0, 255, 240, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 255, 240, 0.02) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: -1;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* Navigation */
    .navbar {
      background: rgba(10, 10, 15, 0.95);
      border-bottom: 1px solid rgba(0, 255, 240, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .navbar-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .navbar-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }

    .logo-text {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 0.1em;
    }

    .navbar-links {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 8px;
      font-family: var(--font-display);
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.15s ease;
      cursor: pointer;
      border: none;
      background: transparent;
    }

    .nav-link:hover,
    .nav-link.active {
      color: var(--neon-cyan);
      background: rgba(0, 255, 240, 0.1);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--bg-card);
      border-radius: 8px;
      border: 1px solid rgba(0, 255, 240, 0.1);
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Pages Container */
    .page {
      display: none;
      padding: 32px 0;
      min-height: calc(100vh - 80px);
    }

    .page.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* Common Styles */
    h1 {
      font-family: var(--font-display);
      font-size: 2rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    h2 {
      font-family: var(--font-display);
      font-size: 1rem;
      color: var(--neon-cyan);
    }

    h3 {
      font-family: var(--font-display);
      font-size: 0.9rem;
      color: var(--neon-cyan);
      margin-bottom: 12px;
    }

    .section {
      background: var(--bg-card);
      border: 1px solid rgba(0, 255, 240, 0.1);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .section-header h2 {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Buttons */
    .btn {
      font-family: var(--font-display);
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: var(--bg-darkest);
      box-shadow: 0 0 20px rgba(0, 255, 240, 0.5);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(0, 255, 240, 0.7);
    }

    .btn-secondary {
      background: transparent;
      color: var(--neon-cyan);
      border: 2px solid var(--neon-cyan);
    }

    .btn-secondary:hover {
      background: rgba(0, 255, 240, 0.1);
    }

    /* Form Elements */
    input,
    select {
      font-family: var(--font-body);
      font-size: 1rem;
      padding: 12px 16px;
      background: var(--bg-card);
      border: 2px solid var(--bg-elevated);
      border-radius: 8px;
      color: var(--text-primary);
      width: 100%;
      transition: all 0.15s ease;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--neon-cyan);
      box-shadow: 0 0 10px rgba(0, 255, 240, 0.3);
    }

    label {
      font-family: var(--font-display);
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-secondary);
      display: block;
      margin-bottom: 4px;
    }

    /* Dashboard Styles */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 32px;
      gap: 32px;
      flex-wrap: wrap;
    }

    .quick-stats {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .quick-stat {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: var(--bg-card);
      border: 1px solid rgba(0, 255, 240, 0.1);
      border-radius: 12px;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-size: 1.25rem;
    }

    .stat-info .stat-value {
      font-family: var(--font-display);
      font-size: 1.25rem;
      font-weight: 700;
      display: block;
    }

    .stat-info .stat-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 32px;
    }

    .main-column {
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    .sidebar-column {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    /* Habit Form */
    .habit-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }

    .habit-field {
      background: var(--bg-elevated);
      border-radius: 8px;
      padding: 12px;
      border: 1px solid rgba(0, 255, 240, 0.05);
      transition: all 0.15s ease;
    }

    .habit-field:hover,
    .habit-field:focus-within {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 255, 240, 0.2);
    }

    .field-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .input-wrapper {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .input-wrapper input {
      padding: 8px 12px;
      font-family: var(--font-mono);
      font-size: 1rem;
      font-weight: 700;
      background: var(--bg-card);
      border: 1px solid transparent;
    }

    .input-wrapper .unit {
      font-size: 0.75rem;
      color: var(--text-muted);
      min-width: 40px;
    }

    .submit-btn {
      width: 100%;
    }

    /* Coach Tip */
    .coach-tip {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(0, 255, 240, 0.1), rgba(191, 0, 255, 0.1));
      border: 1px solid rgba(0, 255, 240, 0.2);
      border-radius: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .tip-icon {
      font-size: 1.5rem;
    }

    .tip-category {
      font-family: var(--font-display);
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--neon-cyan);
      display: block;
      margin-bottom: 4px;
    }

    .tip-content p {
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0;
    }

    /* Match Card */
    .match-card {
      background: var(--bg-card);
      border: 2px solid rgba(0, 255, 240, 0.2);
      border-radius: 16px;
      padding: 24px;
      position: relative;
      overflow: hidden;
    }

    .match-card::before {
      content: '';
      position: absolute;
      top: -100%;
      left: -100%;
      width: 300%;
      height: 300%;
      background: conic-gradient(from 0deg, transparent, rgba(0, 255, 240, 0.05), transparent, rgba(191, 0, 255, 0.05), transparent);
      animation: rotate 15s linear infinite;
      pointer-events: none;
    }

    @keyframes rotate {
      to {
        transform: rotate(360deg);
      }
    }

    .match-card>* {
      position: relative;
      z-index: 1;
    }

    .matchup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .week-badge,
    .status-badge {
      font-family: var(--font-display);
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 4px 12px;
      border-radius: 4px;
    }

    .week-badge {
      background: rgba(0, 255, 240, 0.1);
      border: 1px solid var(--neon-cyan);
      color: var(--neon-cyan);
    }

    .status-badge.winning {
      background: rgba(0, 255, 102, 0.2);
      border: 1px solid var(--neon-green);
      color: var(--neon-green);
    }

    .status-badge.losing {
      background: rgba(255, 0, 170, 0.2);
      border: 1px solid var(--neon-pink);
      color: var(--neon-pink);
    }

    .scoreboard {
      display: flex;
      align-items: stretch;
      gap: 20px;
      margin-bottom: 24px;
    }

    .player-score {
      flex: 1;
      text-align: center;
      padding: 20px;
      background: var(--bg-elevated);
      border-radius: 12px;
      border: 2px solid transparent;
    }

    .player-score.leading {
      border-color: var(--neon-green);
      box-shadow: 0 0 20px rgba(0, 255, 102, 0.2);
    }

    .player-score.user {
      background: linear-gradient(135deg, var(--bg-elevated), rgba(0, 255, 240, 0.1));
    }

    .player-score.opponent {
      background: linear-gradient(135deg, var(--bg-elevated), rgba(191, 0, 255, 0.1));
    }

    .player-name {
      display: block;
      font-family: var(--font-display);
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .score {
      display: block;
      font-family: var(--font-display);
      font-size: 2.5rem;
      font-weight: 900;
      line-height: 1;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .player-score.leading .score {
      background: var(--gradient-success);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .score-label {
      display: block;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-top: 4px;
    }

    .vs-divider {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .vs-divider span {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 900;
      color: var(--electric-purple);
      text-shadow: 0 0 10px var(--electric-purple);
    }

    /* Category Breakdown */
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .category-item {
      background: var(--bg-elevated);
      padding: 16px;
      border-radius: 8px;
      border: 1px solid rgba(0, 255, 240, 0.1);
    }

    .category-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .category-name {
      font-family: var(--font-display);
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(0, 255, 240, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-primary);
      transition: width 0.3s ease;
    }

    .category-scores {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
    }

    .category-scores .you {
      color: var(--neon-cyan);
      font-weight: 700;
    }

    .category-scores .them {
      color: var(--electric-purple);
      font-weight: 700;
    }

    /* Sidebar Cards */
    .sidebar-card {
      background: var(--bg-card);
      border: 1px solid rgba(0, 255, 240, 0.1);
      border-radius: 12px;
      padding: 20px;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    .card-header h3 {
      font-family: var(--font-display);
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin: 0;
    }

    /* League Table */
    .league-table {
      overflow-x: auto;
    }

    .league-table table {
      width: 100%;
      border-collapse: collapse;
    }

    .league-table th {
      font-family: var(--font-display);
      font-size: 0.65rem;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      text-align: left;
      padding: 12px 16px;
      background: var(--bg-elevated);
      color: var(--neon-cyan);
      border-bottom: 2px solid var(--neon-cyan);
    }

    .league-table td {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(0, 255, 240, 0.05);
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .league-table tr:hover td {
      background: rgba(0, 255, 240, 0.05);
    }

    .league-table tr.current-user {
      background: rgba(0, 255, 240, 0.1);
      border-left: 3px solid var(--neon-cyan);
    }

    .rank-cell {
      text-align: center;
      width: 50px;
    }

    .gold {
      color: #ffd700;
    }

    .silver {
      color: #c0c0c0;
    }

    .bronze {
      color: #cd7f32;
    }

    .name-cell {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .you-badge {
      font-family: var(--font-display);
      font-size: 0.55rem;
      font-weight: 700;
      padding: 2px 6px;
      background: var(--gradient-primary);
      border-radius: 4px;
      color: var(--bg-darkest);
    }

    .stat-cell {
      font-family: var(--font-mono);
      font-size: 0.85rem;
      text-align: center;
    }

    .stat-cell.wins {
      color: var(--neon-green);
      font-weight: 700;
    }

    .stat-cell.losses {
      color: var(--neon-pink);
      font-weight: 700;
    }

    .stat-cell.points {
      color: var(--neon-cyan);
      font-weight: 700;
    }

    /* Insights */
    .insights-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .insight-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      background: var(--bg-card);
      border: 1px solid rgba(0, 255, 240, 0.1);
      border-radius: 12px;
    }

    .insight-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-elevated);
      border-radius: 8px;
      font-size: 1.4rem;
    }

    .insight-value {
      font-family: var(--font-display);
      font-size: 1.4rem;
      font-weight: 700;
      display: block;
      text-transform: capitalize;
    }

    .insight-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Rules Page */
    .rules-content {
      max-width: 900px;
      margin: 0 auto;
    }

    .rules-content p {
      color: var(--text-secondary);
      line-height: 1.8;
      margin-bottom: 12px;
    }

    .rules-content ul {
      color: var(--text-secondary);
      line-height: 1.8;
      padding-left: 24px;
      margin-bottom: 16px;
    }

    .scoring-table {
      width: 100%;
      margin: 20px 0;
      border-collapse: collapse;
    }

    .scoring-table th {
      background: var(--bg-elevated);
      color: var(--neon-cyan);
      padding: 12px;
      text-align: left;
      font-family: var(--font-display);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .scoring-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(0, 255, 240, 0.1);
      color: var(--text-secondary);
    }

    .example-box {
      background: rgba(0, 255, 240, 0.05);
      border-left: 3px solid var(--neon-cyan);
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }

    .example-box h4 {
      color: var(--neon-cyan);
      margin-bottom: 12px;
      font-family: var(--font-display);
    }

    .cta-box {
      background: var(--gradient-primary);
      padding: 24px;
      border-radius: 12px;
      margin-top: 32px;
      text-align: center;
    }

    .cta-box h4 {
      color: var(--bg-darkest);
      font-family: var(--font-display);
      margin-bottom: 8px;
    }

    .cta-box p {
      color: rgba(0, 0, 0, 0.7);
      margin: 0;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 16px 24px;
      background: var(--bg-card);
      border: 2px solid var(--neon-green);
      border-radius: 12px;
      box-shadow: 0 0 30px rgba(0, 255, 102, 0.3);
      z-index: 1000;
      animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
      display: none;
    }

    .toast.show {
      display: block;
    }

    .toast.error {
      border-color: var(--neon-pink);
      box-shadow: 0 0 30px rgba(255, 0, 170, 0.3);
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: translateY(20px);
      }
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(0, 255, 240, 0.2);
      border-top-color: var(--neon-cyan);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .insights-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .dashboard-header {
        flex-direction: column;
      }

      .quick-stats {
        width: 100%;
      }

      .scoreboard {
        flex-direction: column;
      }

      .navbar-links {
        gap: 2px;
      }

      .nav-link {
        padding: 6px 8px;
        font-size: 0.6rem;
      }

      .nav-link span {
        display: none;
      }

      .insights-grid {
        grid-template-columns: 1fr;
      }

      .category-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- ============ AUTH SCREEN ============ -->
  <div id="authScreen"
    style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #0a0015 0%, #1a0030 50%, #0a0015 100%); position: fixed; top: 0; left: 0; width: 100%; z-index: 2000;">
    <div
      style="background: rgba(15, 15, 30, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(191, 0, 255, 0.3); border-radius: 20px; padding: 48px; max-width: 450px; width: 100%; box-shadow: 0 20px 60px rgba(191, 0, 255, 0.3);">
      <div style="text-align: center; margin-bottom: 32px;">
        <h1
          style="font-size: 2rem; background: linear-gradient(135deg, #bf00ff 0%, #00fff0 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0;">
          ‚ö° Fantasy Life League</h1>
        <p style="color: #606080; margin-top: 8px;">Track habits, compete with friends</p>
      </div>

      <div id="authError"
        style="display: none; background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.3); border-radius: 8px; padding: 12px; color: #ff6b6b; margin-bottom: 16px;">
      </div>

      <!-- Login form -->
      <form id="loginForm" style="display: flex; flex-direction: column; gap: 20px;">
        <div>
          <label style="font-size: 0.85rem; color: #a0a0c0;">Email</label>
          <input type="email" id="loginEmail" required placeholder="you@example.com"
            style="background: #1e1e3f; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 12px; color: white; width: 100%;">
        </div>
        <div>
          <label style="font-size: 0.85rem; color: #a0a0c0;">Password</label>
          <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            style="background: #1e1e3f; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 12px; color: white; width: 100%;">
        </div>
        <button type="submit"
          style="background: linear-gradient(135deg, #bf00ff, #ff00aa); color: white; border: none; border-radius: 8px; padding: 14px; font-weight: 600; cursor: pointer;">
          Sign In
        </button>
      </form>

      <!-- Signup form -->
      <form id="signupForm" style="display: none; flex-direction: column; gap: 20px;">
        <div>
          <label style="font-size: 0.85rem; color: #a0a0c0;">Name</label>
          <input type="text" id="signupName" required placeholder="John Doe"
            style="background: #1e1e3f; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 12px; color: white; width: 100%;">
        </div>
        <div>
          <label style="font-size: 0.85rem; color: #a0a0c0;">Email</label>
          <input type="email" id="signupEmail" required placeholder="you@example.com"
            style="background: #1e1e3f; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 12px; color: white; width: 100%;">
        </div>
        <div>
          <label style="font-size: 0.85rem; color: #a0a0c0;">Password</label>
          <input type="password" id="signupPassword" required minlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            style="background: #1e1e3f; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 12px; color: white; width: 100%;">
        </div>
        <button type="submit"
          style="background: linear-gradient(135deg, #bf00ff, #ff00aa); color: white; border: none; border-radius: 8px; padding: 14px; font-weight: 600; cursor: pointer;">
          Create Account
        </button>
      </form>

      <div style="text-align: center; margin-top: 24px; color: #606080;">
        <span id="authToggleText">Don't have an account?</span>
        <button type="button" id="authToggle"
          style="background: none; border: none; color: #00fff0; cursor: pointer; text-decoration: underline;">
          Sign Up
        </button>
      </div>
    </div>
  </div>

  <!-- ============ MAIN APP ============ -->
  <div id="mainApp" style="display: none;">
    <!-- Navbar -->
    <nav class="navbar">
      <div class="navbar-container">
        <a href="#" class="navbar-logo">
          <span class="logo-text">‚ö° FLL</span>
        </a>
        <div class="navbar-links">
          <button class="nav-link active" data-page="dashboard">
            <span>üìä</span> Dashboard
          </button>
          <button class="nav-link" data-page="league">
            <span>üèÜ</span> League
          </button>
          <button class="nav-link" data-page="matchup">
            <span>‚öîÔ∏è</span> Matchup
          </button>
          <button class="nav-link" data-page="insights">
            <span>üìà</span> Insights
          </button>
          <button class="nav-link" data-page="rules">
            <span>üìñ</span> Rules
          </button>
          <div class="user-info">
            <span id="userName">Player</span>
          </div>
          <button class="nav-link" onclick="logout()" style="color: #ff6b6b; border: 1px solid rgba(255,0,0,0.3);">
            Logout
          </button>
        </div>
      </div>
    </nav>

    <!-- Dashboard Page -->
    <div id="dashboard" class="page active">
      <div class="container">
        <div class="dashboard-header">
          <div>
            <h1>Welcome back, <span id="welcomeName">Player</span>!</h1>
            <p style="color: var(--text-secondary);">Week <span id="weekNumber">1</span> ‚Ä¢
              <span style="color: var(--neon-cyan);">Season 1</span>
            </p>
          </div>
          <div class="quick-stats">
            <div class="quick-stat">
              <div class="stat-icon" style="background: rgba(0, 255, 240, 0.1); color: var(--neon-cyan);">üî•</div>
              <div class="stat-info">
                <span class="stat-value" id="streakValue">0</span>
                <span class="stat-label">Day Streak</span>
              </div>
            </div>
            <div class="quick-stat">
              <div class="stat-icon" style="background: rgba(191, 0, 255, 0.1); color: var(--electric-purple);">‚ö°</div>
              <div class="stat-info">
                <span class="stat-value" id="weekPoints">0</span>
                <span class="stat-label">Week Points</span>
              </div>
            </div>
            <div class="quick-stat">
              <div class="stat-icon" style="background: rgba(255, 0, 170, 0.1); color: var(--neon-pink);">üèÜ</div>
              <div class="stat-info">
                <span class="stat-value" id="record">0-0</span>
                <span class="stat-label">Record</span>
              </div>
            </div>
          </div>
        </div>

        <div class="dashboard-grid">
          <!-- Main Column -->
          <div class="main-column">
            <!-- Health Sync Card (visual only) -->
            <div id="healthSyncCard" class="section">
              <!-- Populated by JS -->
            </div>

            <!-- Matchup Card (Preview) -->
            <div class="match-card" id="fullMatchCard">
              <!-- Populated by JS -->
            </div>

            <!-- Habit Log -->
            <div class="section">
              <div class="section-header">
                <h2>üìù Log Habits</h2>
                <span id="todayPoints"
                  style="font-family: var(--font-mono); color: var(--neon-green); font-weight: 700;">+0.0 pts</span>
              </div>
              <div class="habit-grid">
                <div class="habit-field">
                  <div class="field-header">
                    <span>üåô</span>
                    <label>Sleep</label>
                  </div>
                  <div class="input-wrapper">
                    <input type="number" id="sleep" step="0.5" min="0" max="24" placeholder="0">
                    <span class="unit">hrs</span>
                  </div>
                </div>
                <div class="habit-field">
                  <div class="field-header">
                    <span>üìö</span>
                    <label>Study</label>
                  </div>
                  <div class="input-wrapper">
                    <input type="number" id="study" step="0.5" min="0" max="24" placeholder="0">
                    <span class="unit">hrs</span>
                  </div>
                </div>
                <div class="habit-field">
                  <div class="field-header">
                    <span>üèãÔ∏è</span>
                    <label>Exercise</label>
                  </div>
                  <div class="input-wrapper">
                    <input type="number" id="exercise" step="0.5" min="0" max="24" placeholder="0">
                    <span class="unit">hrs</span>
                  </div>
                </div>
                <div class="habit-field">
                  <div class="field-header">
                    <span>üíß</span>
                    <label>Hydration</label>
                  </div>
                  <div class="input-wrapper">
                    <input type="number" id="hydration" min="0" max="20" placeholder="0">
                    <span class="unit">cups</span>
                  </div>
                </div>
                <div class="habit-field">
                  <div class="field-header">
                    <span>üçé</span>
                    <label>Nutrition</label>
                  </div>
                  <div class="input-wrapper">
                    <input type="number" id="nutrition" min="0" max="10" placeholder="0">
                    <span class="unit">/10</span>
                  </div>
                </div>
                <div class="habit-field">
                  <div class="field-header">
                    <span>üß†</span>
                    <label>Mind</label>
                  </div>
                  <div class="input-wrapper">
                    <input type="number" id="mindfulness" min="0" max="120" placeholder="0">
                    <span class="unit">min</span>
                  </div>
                </div>
                <div class="habit-field">
                  <div class="field-header">
                    <span>üì±</span>
                    <label>Screen</label>
                  </div>
                  <div class="input-wrapper">
                    <input type="number" id="screentime" step="0.5" min="0" max="24" placeholder="0">
                    <span class="unit">hrs</span>
                  </div>
                </div>
              </div>

              <div id="coachTip" class="coach-tip" style="display: none;">
                <div class="tip-icon">üí°</div>
                <div class="tip-content">
                  <span class="tip-category" id="tipCategory">Tip</span>
                  <p id="tipMessage">Message</p>
                </div>
              </div>

              <button class="btn btn-primary submit-btn" onclick="logHabits()">Log Habits</button>
            </div>
          </div>

          <!-- Sidebar -->
          <div class="sidebar-column">
            <div class="sidebar-card">
              <div class="card-header">
                <h3>Weekly Progress</h3>
              </div>
              <div style="text-align: center; margin-bottom: 16px;">
                <span id="daysLogged"
                  style="font-family: var(--font-display); font-size: 2rem; font-weight: 700; color: var(--text-primary);">0/7</span>
                <span
                  style="display: block; font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">Days
                  Logged</span>
              </div>
              <div style="text-align: center;">
                <span id="totalWeekPts"
                  style="font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; color: var(--neon-cyan);">0.0</span>
                <span
                  style="display: block; font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">Total
                  Points</span>
              </div>
            </div>

            <div class="sidebar-card">
              <div class="card-header">
                <h3>Match History</h3>
              </div>
              <div id="matchHistory" style="display: flex; flex-direction: column; gap: 8px;">
                <div style="font-size: 0.85rem; color: var(--text-muted); text-align:center;">
                  Match history coming soon.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- League Page -->
    <div id="league" class="page">
      <div class="container">
        <h1>üèÜ League Standings</h1>

        <div class="section">
          <div class="section-header">
            <div>
              <h2 id="leagueName">No League</h2>
              <p style="color: var(--text-secondary); font-size: 0.9rem;">Invite Code:
                <span id="inviteCode" style="font-family: var(--font-mono); color: var(--neon-cyan); cursor: pointer;"
                  onclick="copyCode()">---</span>
              </p>
            </div>
            <span id="playerCount"
              style="font-family: var(--font-display); font-size: 0.9rem; color: var(--text-muted);">üë• 0
              Players</span>
          </div>

          <!-- League Actions -->
          <div style="margin-bottom: 24px; display: flex; gap: 12px;">
            <button class="btn btn-primary" onclick="createLeague()">‚ûï Create League</button>
            <button class="btn btn-secondary" onclick="joinLeague()">üîó Join League</button>
          </div>

          <div class="league-table">
            <table>
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Player</th>
                  <th>W</th>
                  <th>L</th>
                  <th>Total Pts</th>
                  <th>Wk Pts</th>
                </tr>
              </thead>
              <tbody id="standingsBody">
                <tr>
                  <td colspan="6" style="text-align:center; padding: 20px;">
                    No players yet. Create or join a league!
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Matchup Page (NEW!) -->
    <div id="matchup" class="page">
      <div class="container">
        <h1>‚öîÔ∏è This Week's Matchup</h1>

        <div class="section">
          <div class="matchup-header">
            <span class="week-badge">Week <span id="matchupWeek">1</span></span>
            <span style="color: var(--electric-purple); font-size: 1.5rem;">‚öîÔ∏è</span>
            <span class="status-badge" id="matchupStatus">TBD</span>
          </div>

          <div class="scoreboard">
            <div class="player-score user" id="userScoreCard">
              <span class="player-name" id="matchupUserName">You</span>
              <span class="score" id="matchupUserScore">0.0</span>
              <span class="score-label">points</span>
            </div>
            <div class="vs-divider"><span>VS</span></div>
            <div class="player-score opponent" id="oppScoreCard">
              <span class="player-name" id="matchupOppName">Opponent</span>
              <span class="score" id="matchupOppScore">0.0</span>
              <span class="score-label">points</span>
            </div>
          </div>

          <div style="margin-top: 32px;">
            <h3>üìä Category Breakdown</h3>
            <div class="category-grid" id="categoryBreakdown">
              <!-- Populated by JS -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Insights Page -->
    <div id="insights" class="page">
      <div class="container">
        <h1>üìà Performance Insights</h1>

        <div class="insights-grid">
          <div class="insight-card">
            <div class="insight-icon">üî•</div>
            <div class="insight-info">
              <span class="insight-value" id="insightStreak">0</span>
              <span class="insight-label">Day Streak</span>
            </div>
          </div>
          <div class="insight-card">
            <div class="insight-icon">üìÖ</div>
            <div class="insight-info">
              <span class="insight-value" id="insightDays">0</span>
              <span class="insight-label">Days Logged</span>
            </div>
          </div>
          <div class="insight-card">
            <div class="insight-icon">‚≠ê</div>
            <div class="insight-info">
              <span class="insight-value" id="bestHabit">-</span>
              <span class="insight-label">Best Habit</span>
            </div>
          </div>
          <div class="insight-card">
            <div class="insight-icon">‚ö†Ô∏è</div>
            <div class="insight-info">
              <span class="insight-value" id="worstHabit">-</span>
              <span class="insight-label">Needs Focus</span>
            </div>
          </div>
        </div>

        <div class="dashboard-grid">
          <div class="main-column">
            <div class="section">
              <h2>üìä Habit Averages</h2>
              <div class="habit-grid" id="averagesGrid">
                <div style="color: var(--text-muted); font-size: 0.85rem;">
                  Averages will show as you log more days.
                </div>
              </div>
            </div>

            <div class="section">
              <h2>üìà Category Performance</h2>
              <div class="category-grid">
                <div class="category-item">
                  <div class="category-header">
                    <span class="category-name">üò¥ Sleep</span>
                    <span style="color: var(--neon-cyan); font-weight: 700;">90%</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: 90%;"></div>
                  </div>
                  <p style="font-size: 0.8rem; color: var(--text-muted);">7.8 / 8.0 hrs average</p>
                </div>
                <div class="category-item">
                  <div class="category-header">
                    <span class="category-name">üìö Study</span>
                    <span style="color: var(--neon-cyan); font-weight: 700;">75%</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: 75%;"></div>
                  </div>
                  <p style="font-size: 0.8rem; color: var(--text-muted);">1.5 / 2.0 hrs average</p>
                </div>
                <div class="category-item">
                  <div class="category-header">
                    <span class="category-name">üèãÔ∏è Exercise</span>
                    <span style="color: var(--neon-cyan); font-weight: 700;">65%</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%;"></div>
                  </div>
                  <p style="font-size: 0.8rem; color: var(--text-muted);">0.65 / 1.0 hrs average</p>
                </div>
                <div class="category-item">
                  <div class="category-header">
                    <span class="category-name">üíß Hydration</span>
                    <span style="color: var(--neon-cyan); font-weight: 700;">80%</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: 80%;"></div>
                  </div>
                  <p style="font-size: 0.8rem; color: var(--text-muted);">6.4 / 8 cups average</p>
                </div>
              </div>
            </div>
          </div>

          <div class="sidebar-column">
            <div class="section">
              <h2>üí° AI Coach Tips</h2>
              <div id="recommendations" style="display: flex; flex-direction: column; gap: 12px;">
                <div
                  style="padding:12px;border-radius:8px;background:rgba(0,255,240,0.05);border:1px solid rgba(0,255,240,0.2);font-size:0.85rem;color:var(--text-secondary);">
                  Your sleep consistency is excellent! Keep it up.
                </div>
                <div
                  style="padding:12px;border-radius:8px;background:rgba(0,255,240,0.05);border:1px solid rgba(0,255,240,0.2);font-size:0.85rem;color:var(--text-secondary);">
                  Try adding 30 more minutes of study time to hit your goals.
                </div>
                <div
                  style="padding:12px;border-radius:8px;background:rgba(0,255,240,0.05);border:1px solid rgba(0,255,240,0.2);font-size:0.85rem;color:var(--text-secondary);">
                  Morning workouts correlate with your best days!
                </div>
                <div
                  style="padding:12px;border-radius:8px;background:rgba(0,255,240,0.05);border:1px solid rgba(0,255,240,0.2);font-size:0.85rem;color:var(--text-secondary);">
                  Your hydration dips on weekends - set reminders!
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Rules Page (NEW!) -->
    <div id="rules" class="page">
      <div class="container">
        <div class="rules-content">
          <h1 style="margin-bottom: 24px;">üìñ Fantasy Life League Rules</h1>

          <div class="section">
            <h3>üéØ How It Works</h3>
            <p>Fantasy Life League is a habit-tracking game where you compete with friends by logging daily activities.
              Each habit you complete earns points, and whoever has the most points at the end of the week wins!</p>
          </div>

          <div class="section">
            <h3>‚ö° Scoring System</h3>
            <p>Each habit category can earn up to <strong>10 points per day</strong>. Your score is based on how well
              you meet your personal goals:</p>

            <table class="scoring-table">
              <thead>
                <tr>
                  <th>Habit</th>
                  <th>Goal</th>
                  <th>Scoring</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>üò¥ Sleep</td>
                  <td>8 hours</td>
                  <td>100% of goal = 10 pts. Can earn up to 15 pts at 150% of goal</td>
                </tr>
                <tr>
                  <td>üìö Study</td>
                  <td>2 hours</td>
                  <td>100% of goal = 10 pts. Can earn up to 15 pts at 150% of goal</td>
                </tr>
                <tr>
                  <td>üèãÔ∏è Exercise</td>
                  <td>1 hour</td>
                  <td>100% of goal = 10 pts. Can earn up to 15 pts at 150% of goal</td>
                </tr>
                <tr>
                  <td>üíß Hydration</td>
                  <td>8 glasses</td>
                  <td>100% of goal = 10 pts. Can earn up to 15 pts at 150% of goal</td>
                </tr>
                <tr>
                  <td>üçé Nutrition</td>
                  <td>3 meals</td>
                  <td>All-or-nothing: 3+ meals = 10 pts, otherwise 0</td>
                </tr>
                <tr>
                  <td>üß† Mindfulness</td>
                  <td>15 minutes</td>
                  <td>Bonus category - adds to total based on time logged</td>
                </tr>
              </tbody>
            </table>

            <div class="example-box">
              <h4>üìù Example Calculation</h4>
              <p><strong>Your Daily Log:</strong></p>
              <ul>
                <li>Sleep: 8 hours (100% of goal) = <strong>10 points</strong></li>
                <li>Study: 3 hours (150% of goal) = <strong>15 points</strong></li>
                <li>Exercise: 0.5 hours (50% of goal) = <strong>5 points</strong></li>
                <li>Hydration: 6 glasses (75% of goal) = <strong>7.5 points</strong></li>
                <li>Nutrition: 3 meals (met goal) = <strong>10 points</strong></li>
                <li>Mindfulness: 20 minutes = <strong>2 points</strong></li>
              </ul>
              <p style="margin-top: 10px;"><strong>Total for the day: 49.5 points</strong></p>
            </div>
          </div>

          <div class="section">
            <h3>üèÜ League Competition</h3>
            <p><strong>Weekly Matchups:</strong> Each week, you're paired with another player in your league. The player
              with the higher weekly score wins the matchup.</p>
            <p><strong>Standings:</strong> Your rank is determined by your win-loss record, with total points as the
              tiebreaker.</p>
            <p><strong>Championships:</strong> At the end of the season (12 weeks), the top players compete in a playoff
              bracket!</p>
          </div>

          <div class="section">
            <h3>üìÖ Important Rules</h3>
            <ul>
              <li><strong>Logging Window:</strong> You can log habits once per day. You can update your entry until
                midnight.</li>
              <li><strong>Week Start:</strong> Weeks run Monday to Sunday. Scores reset every Monday.</li>
              <li><strong>Consistency Bonus:</strong> Log all 7 days to earn a 10-point bonus!</li>
              <li><strong>Custom Goals:</strong> You can adjust your personal goals in settings, but they affect point
                calculations.</li>
              <li><strong>Fair Play:</strong> Be honest! This is about self-improvement, not just winning.</li>
            </ul>
          </div>

          <div class="section">
            <h3>üéÆ Tips for Success</h3>
            <ul>
              <li>Set realistic goals that challenge but don't overwhelm you</li>
              <li>Log your habits at the same time each day to build consistency</li>
              <li>Focus on your weakest category - small improvements add up!</li>
              <li>Check your Insights page for personalized recommendations</li>
              <li>Engage with your league - friendly competition motivates everyone!</li>
            </ul>
          </div>

          <div class="cta-box">
            <h4>üí™ Ready to Start?</h4>
            <p>Head to the Dashboard, log your first habits, and start building a better you while competing with
              friends!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script>
    // ============ CONFIG ============
    const API_URL = 'http://localhost:8000';
    let authToken = localStorage.getItem('authToken');
    let currentUser = null;

    // ============ GLOBAL STATE ============
    let state = {
      user: { name: 'Player', wins: 0, losses: 0 },
      habits: {},
      weekPoints: 0,
      daysLogged: 0,
      streak: 0,
      lastLogDate: null,
      todayPoints: 0,
      league: {
        name: 'Demo League',
        code: 'DEMO01',
        players: [
          {
            player_id: 'demo1',
            name: 'Sarah Chen',
            wins: 4,
            losses: 1,
            total_points: 487.5,
            rank: 1,
            current_week_score: { total: 52.3 }
          },
          {
            player_id: 'demo2',
            name: 'Mike Rodriguez',
            wins: 3,
            losses: 2,
            total_points: 421.8,
            rank: 2,
            current_week_score: { total: 45.7 }
          },
          {
            player_id: 'current_user',
            name: 'Player',
            wins: 0,
            losses: 0,
            total_points: 0,
            rank: 3,
            current_week_score: { total: 0 }
          }
        ]
      },
      matchup: {
        week: 1,
        opponent: 'Opponent',
        userScore: 0,
        oppScore: 0,
        categories: {
          sleep: { user: 0, opp: 0 },
          study: { user: 0, opp: 0 },
          exercise: { user: 0, opp: 0 },
          hydration: { user: 0, opp: 0 },
          nutrition: { user: 0, opp: 0 }
        }
      }
    };

    // Helper to get week number
    if (!Date.prototype.getWeekNumber) {
      Date.prototype.getWeekNumber = function () {
        const date = new Date(this.getTime());
        date.setHours(0, 0, 0, 0);
        date.setDate(date.getDate() + 4 - (date.getDay() || 7));
        const yearStart = new Date(date.getFullYear(), 0, 1);
        const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
        return weekNo;
      };
    }

    // ============ INITIAL LOAD ============
    document.addEventListener('DOMContentLoaded', () => {
      if (authToken) {
        verifyAndLoadUser();
      } else {
        showAuthScreen();
      }
    });

    // ============ AUTH UI HELPERS ============
    function showAuthScreen() {
      document.getElementById('authScreen').style.display = 'flex';
      document.getElementById('mainApp').style.display = 'none';
    }

    function showMainApp() {
      document.getElementById('authScreen').style.display = 'none';
      document.getElementById('mainApp').style.display = 'block';
      fetchHealthStatus();
    }

    function showAuthError(message) {
      const errorEl = document.getElementById('authError');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
      setTimeout(() => errorEl.style.display = 'none', 5000);
    }

    // Toggle login/signup
    document.getElementById('authToggle').addEventListener('click', () => {
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');
      const toggleText = document.getElementById('authToggleText');
      const toggleBtn = document.getElementById('authToggle');

      if (loginForm.style.display === 'none') {
        loginForm.style.display = 'flex';
        signupForm.style.display = 'none';
        toggleText.textContent = "Don't have an account?";
        toggleBtn.textContent = "Sign Up";
      } else {
        loginForm.style.display = 'none';
        signupForm.style.display = 'flex';
        toggleText.textContent = "Already have an account?";
        toggleBtn.textContent = "Sign In";
      }
    });

    // ============ AUTH: LOGIN ============
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const response = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: document.getElementById('loginEmail').value,
            password: document.getElementById('loginPassword').value
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.detail || 'Login failed');
        }

        const data = await response.json();
        authToken = data.access_token;
        localStorage.setItem('authToken', authToken);
        await verifyAndLoadUser();
        showToast('Welcome back!', false);
      } catch (error) {
        showAuthError(error.message);
      }
    });

    // ============ AUTH: SIGNUP ============
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const response = await fetch(`${API_URL}/auth/signup`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: document.getElementById('signupName').value,
            email: document.getElementById('signupEmail').value,
            password: document.getElementById('signupPassword').value
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.detail || 'Signup failed');
        }

        const data = await response.json();
        authToken = data.access_token;
        localStorage.setItem('authToken', authToken);
        await verifyAndLoadUser();
        showToast('Account created!', false);
      } catch (error) {
        showAuthError(error.message);
      }
    });

    async function verifyAndLoadUser() {
      try {
        await loadUserData();
        showMainApp();
      } catch (error) {
        console.error("Auth failed:", error);
        localStorage.removeItem('authToken');
        authToken = null;
        showAuthScreen();
      }
    }

    async function loadUserData() {
      const response = await fetch(`${API_URL}/auth/me`, {
        headers: { 'Authorization': `Bearer ${authToken}` }
      });

      if (!response.ok) throw new Error('Failed to load user');

      currentUser = await response.json();
      state.user.name = currentUser.name;

      // Update demo league player with actual user info
      const demoUser = state.league.players.find(p => p.player_id === 'current_user');
      if (demoUser) {
        demoUser.name = currentUser.name;
        demoUser.player_id = currentUser._id;
      }

      await loadWeekData();
      await loadLeaguePlayers();
      updateUI();
    }

    // ============ HABITS LOAD ============
    async function loadWeekData() {
      try {
        const response = await fetch(`${API_URL}/habits/week`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });

        if (!response.ok) return;

        const data = await response.json();
        state.weekPoints = data.score.total;
        state.daysLogged = data.score.days_logged;
        state.matchup.userScore = data.score.total;
        state.matchup.week = data.week;

        // Update demo league player with actual scores
        const demoUser = state.league.players.find(p => p.player_id === currentUser._id);
        if (demoUser) {
          demoUser.current_week_score = { total: data.score.total };
          demoUser.total_points += data.score.total;
        }

        // load today's entry if exists
        const todayRes = await fetch(`${API_URL}/habits/today`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        if (todayRes.ok) {
          const todayData = await todayRes.json();
          state.habits = todayData;
          state.todayPoints = todayData.total_points;
          state.lastLogDate = new Date().toISOString().split('T')[0];

          if (todayData.sleep) document.getElementById('sleep').value = todayData.sleep;
          if (todayData.study) document.getElementById('study').value = todayData.study;
          if (todayData.exercise) document.getElementById('exercise').value = todayData.exercise;
          if (todayData.hydration) document.getElementById('hydration').value = todayData.hydration;
          if (todayData.nutrition) document.getElementById('nutrition').value = todayData.nutrition;
          if (todayData.mindfulness) document.getElementById('mindfulness').value = todayData.mindfulness;
        }
      } catch (error) {
        console.error('Error loading week data:', error);
      }
    }

    // ============ LOGOUT ============
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('authToken');
        location.reload();
      }
    }

    // ============ HABIT LOGGING (FIXED!) ============
    async function logHabits() {
      const today = new Date().toISOString().split('T')[0];
      const alreadyLoggedToday = state.lastLogDate === today;

      const habits = {
        sleep: parseFloat(document.getElementById('sleep').value) || null,
        study: parseFloat(document.getElementById('study').value) || null,
        exercise: parseFloat(document.getElementById('exercise').value) || null,
        hydration: parseInt(document.getElementById('hydration').value) || null,
        nutrition: parseInt(document.getElementById('nutrition').value) || null,
        mindfulness: parseInt(document.getElementById('mindfulness').value) || null
      };

      Object.keys(habits).forEach(key => habits[key] === null && delete habits[key]);

      if (Object.keys(habits).length === 0) {
        showToast('Please enter at least one habit!', true);
        return;
      }

      try {
        const response = await fetch(`${API_URL}/habits/log`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(habits)
        });

        if (!response.ok) throw new Error('Failed to log habits');

        const data = await response.json();
        const newPoints = data.total_points;

        if (alreadyLoggedToday) {
          // UPDATE: Calculate difference
          const oldPoints = state.todayPoints || 0;
          const pointsDiff = newPoints - oldPoints;

          state.habits = { ...state.habits, ...habits };
          state.todayPoints = newPoints;
          state.weekPoints += pointsDiff;

          // Update demo league player score
          const demoUser = state.league.players.find(p => p.player_id === currentUser._id);
          if (demoUser) {
            demoUser.total_points += pointsDiff;
            demoUser.current_week_score.total += pointsDiff;
          }

          // Update matchup categories
          updateMatchupCategories(habits);

          await loadWeekData();
          showCoachTip(habits);
          updateUI();

          // FIX APPLIED HERE!
          showToast(`Habits updated! ${pointsDiff >= 0 ? '+' : ''}${pointsDiff.toFixed(1)} points`, false, Math.abs(pointsDiff));
        } else {
          // NEW LOG: Add full points
          state.habits = { ...state.habits, ...habits };
          state.todayPoints = newPoints;
          state.weekPoints += newPoints;
          state.daysLogged = Math.min(7, state.daysLogged + 1);
          state.lastLogDate = today;

          // Update demo league player score
          const demoUser = state.league.players.find(p => p.player_id === currentUser._id);
          if (demoUser) {
            demoUser.total_points += newPoints;
            demoUser.current_week_score.total += newPoints;
          }

          // Update matchup categories
          updateMatchupCategories(habits);

          await loadWeekData();
          showCoachTip(habits);
          updateUI();

          showToast(`Habits logged! +${newPoints.toFixed(1)} points`, false, newPoints);
        }
      } catch (error) {
        showToast('Error logging habits', true);
        console.error(error);
      }
    }

    function updateMatchupCategories(habits) {
      // Simple demo update for matchup categories
      if (habits.sleep) state.matchup.categories.sleep.user = parseFloat(habits.sleep);
      if (habits.study) state.matchup.categories.study.user = parseFloat(habits.study);
      if (habits.exercise) state.matchup.categories.exercise.user = parseFloat(habits.exercise);
      if (habits.hydration) state.matchup.categories.hydration.user = parseFloat(habits.hydration);
      if (habits.nutrition) state.matchup.categories.nutrition.user = parseFloat(habits.nutrition);

      // Generate random opponent scores for demo
      state.matchup.categories.sleep.opp = Math.random() * 8 + 4;
      state.matchup.categories.study.opp = Math.random() * 3 + 1;
      state.matchup.categories.exercise.opp = Math.random() * 1.5 + 0.5;
      state.matchup.categories.hydration.opp = Math.random() * 6 + 4;
      state.matchup.categories.nutrition.opp = Math.random() * 8 + 2;

      // Update opponent score
      state.matchup.oppScore = (Math.random() * 30 + 20).toFixed(1);
    }

    // ============ LEAGUE MANAGEMENT ============
    async function createLeague() {
      const name = prompt("Enter league name:");
      if (!name) return;

      try {
        const response = await fetch(`${API_URL}/league/create`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ name })
        });

        if (!response.ok) throw new Error('Failed to create league');

        const data = await response.json();
        showToast(`League created! Code: ${data.code}`, false);
        await loadLeaguePlayers();
      } catch (error) {
        showToast('Error creating league: ' + error.message, true);
      }
    }

    async function joinLeague() {
      const code = prompt("Enter invite code:");
      if (!code) return;

      try {
        const response = await fetch(`${API_URL}/league/join`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ code: code.toUpperCase() })
        });

        if (!response.ok) throw new Error('Invalid code or already in league');

        showToast('Joined league!', false);
        await loadLeaguePlayers();
      } catch (error) {
        showToast(error.message, true);
      }
    }

    async function loadLeaguePlayers() {
      try {
        const response = await fetch(`${API_URL}/league/standings`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });

        if (!response.ok) {
          state.league.players = [];
          state.league.name = "No League";
          state.league.code = "---";
          updateLeague();
          return;
        }

        const data = await response.json();
        state.league.name = data.league.name;
        state.league.code = data.league.code;
        state.league.players = data.standings || [];
        updateLeague();
      } catch (error) {
        console.error('Error loading league:', error);
      }
    }

    // ============ HEALTH (VISUAL ONLY) ============
    let healthState = {
      lastSync: null,
      isSyncing: false,
      data: {
        steps: 0,
        calories: 0,
        distance: 0,
        workouts: 0
      },
      status: 'not-synced'
    };

    async function fetchHealthStatus() {
      updateHealthUI();
    }

    async function syncHealthData() {
      if (healthState.isSyncing) return;

      // Prompt for Apple ID login
      const appleId = prompt("Sign in to Apple Health:\n\nEnter your Apple ID:");
      if (!appleId) {
        showToast('Apple Health login cancelled', true);
        return;
      }

      const password = prompt("Enter your Apple ID password:");
      if (!password) {
        showToast('Apple Health login cancelled', true);
        return;
      }

      healthState.isSyncing = true;
      updateHealthUI();

      try {
        // Simulate authentication
        await new Promise(resolve => setTimeout(resolve, 1000));

        const mockData = {
          steps: Math.floor(Math.random() * 5000) + 7000,
          calories: Math.floor(Math.random() * 300) + 400,
          distance: Math.floor(Math.random() * 3) + 5,
          workouts: Math.floor(Math.random() * 2) + 1
        };

        await new Promise(resolve => setTimeout(resolve, 1000));

        healthState.data = mockData;
        healthState.status = 'synced';
        healthState.lastSync = new Date();

        updateHealthUI();
        showToast(`Signed in as ${appleId} - Health data synced!`, false);
      } catch (error) {
        healthState.status = 'error';
        updateHealthUI();
      } finally {
        healthState.isSyncing = false;
        updateHealthUI();
      }
    }

    function updateHealthUI() {
      const container = document.getElementById('healthSyncCard');
      if (!container) return;

      const statusBadge = healthState.isSyncing
        ? `<span class="sync-status"><span class="loading-spinner"></span> Syncing...</span>`
        : healthState.status === 'synced'
          ? `<span class="sync-status synced">‚úì Synced ${formatTimeAgo(healthState.lastSync)}</span>`
          : healthState.status === 'error'
            ? `<span class="sync-status error">‚úó Sync Failed</span>`
            : `<span class="sync-status">‚óã Not Synced</span>`;

      container.innerHTML = `
        <div class="section-header">
          <h2>üèÉ Health Data</h2>
          ${statusBadge}
        </div>
        <div class="health-metrics" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;">
          <div class="health-metric">
            <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
              <span style="color:#00ff66;">üëü</span>
              <span style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;">Steps</span>
            </div>
            <div style="color:#00ff66;font-family:var(--font-display);font-size:1.4rem;font-weight:700;">
              ${healthState.data.steps.toLocaleString()}
              <span style="font-size:0.7rem;color:var(--text-muted);font-weight:400;">steps</span>
            </div>
          </div>
          <div class="health-metric">
            <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
              <span style="color:#ff6600;">üî•</span>
              <span style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;">Calories</span>
            </div>
            <div style="color:#ff6600;font-family:var(--font-display);font-size:1.4rem;font-weight:700;">
              ${healthState.data.calories}
              <span style="font-size:0.7rem;color:var(--text-muted);font-weight:400;">kcal</span>
            </div>
          </div>
          <div class="health-metric">
            <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
              <span style="color:#00b8ff;">üìè</span>
              <span style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;">Distance</span>
            </div>
            <div style="color:#00b8ff;font-family:var(--font-display);font-size:1.4rem;font-weight:700;">
              ${healthState.data.distance.toFixed(1)}
              <span style="font-size:0.7rem;color:var(--text-muted);font-weight:400;">km</span>
            </div>
          </div>
          <div class="health-metric">
            <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
              <span style="color:#bf00ff;">üí™</span>
              <span style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;">Workouts</span>
            </div>
            <div style="color:#bf00ff;font-family:var(--font-display);font-size:1.4rem;font-weight:700;">
              ${healthState.data.workouts}
              <span style="font-size:0.7rem;color:var(--text-muted);font-weight:400;">today</span>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:center;margin-top:12px;">
          <button class="btn btn-primary" onclick="syncHealthData()" ${healthState.isSyncing ? 'disabled' : ''}>
            ${healthState.isSyncing ? '‚è≥ Syncing...' : 'üîÑ Sync Health Data'}
          </button>
        </div>
      `;
    }

    function formatTimeAgo(date) {
      if (!date) return '';
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return 'just now';
      if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
      return `${Math.floor(seconds / 86400)}d ago`;
    }

    // ============ UI HELPERS ============
    function showCoachTip(habits) {
      const tips = {
        sleep: {
          low: "Sleep debt is real! Getting less than 7 hours can impair memory and decision-making.",
          good: "Great sleep! Quality rest boosts learning and memory consolidation."
        },
        exercise: {
          low: "Even a 10-minute walk can boost creativity and reduce stress!",
          good: "Excellent workout! Exercise releases BDNF, which helps grow new brain cells."
        },
        hydration: {
          low: "Mild dehydration can reduce concentration by 25%!",
          good: "Well hydrated! Water keeps your brain functioning optimally."
        }
      };

      let category, message;
      const sleep = parseFloat(habits.sleep) || 0;
      const exercise = parseFloat(habits.exercise) || 0;
      const hydration = parseFloat(habits.hydration) || 0;

      if (sleep < 7 && sleep > 0) {
        category = 'Sleep';
        message = tips.sleep.low;
      } else if (exercise < 0.5 && exercise > 0) {
        category = 'Exercise';
        message = tips.exercise.low;
      } else if (hydration < 6 && hydration > 0) {
        category = 'Hydration';
        message = tips.hydration.low;
      } else if (sleep >= 7) {
        category = 'Sleep';
        message = tips.sleep.good;
      } else if (exercise >= 0.5) {
        category = 'Exercise';
        message = tips.exercise.good;
      } else if (hydration >= 6) {
        category = 'Hydration';
        message = tips.hydration.good;
      } else {
        category = 'General';
        message = 'Consistency beats intensity ‚Äì small daily habits compound into big results!';
      }

      document.getElementById('tipCategory').textContent = category;
      document.getElementById('tipMessage').textContent = message;
      document.getElementById('coachTip').style.display = 'flex';
    }

    function showToast(message, isError = false, points = null) {
      const toast = document.getElementById('toast');
      toast.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px;">
          <span style="font-size:1.5rem;">${isError ? '‚ùå' : '‚úÖ'}</span>
          <div>
            <div style="font-weight:700;">${message}</div>
            ${points ? `<div style="font-size:0.8rem;opacity:0.8;">+${points.toFixed ? points.toFixed(1) : points} points earned!</div>` : ''}
          </div>
        </div>
      `;
      toast.className = isError ? 'toast show error' : 'toast show';

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function copyCode() {
      if (!state.league.code || state.league.code === '---') {
        showToast('No league code yet ‚Äì create or join a league first!', true);
        return;
      }
      navigator.clipboard.writeText(state.league.code);
      showToast('Invite code copied!');
    }

    function updateUI() {
      // Header / navbar
      document.getElementById('userName').textContent = state.user.name;
      document.getElementById('welcomeName').textContent = state.user.name.split(' ')[0] || 'Player';

      document.getElementById('streakValue').textContent = state.streak;
      document.getElementById('weekPoints').textContent = state.weekPoints.toFixed(1);
      document.getElementById('record').textContent = `${state.user.wins}-${state.user.losses}`;
      document.getElementById('weekNumber').textContent = state.matchup.week;

      // Weekly sidebar
      document.getElementById('todayPoints').textContent = `+${state.todayPoints.toFixed(1)} pts`;
      document.getElementById('daysLogged').textContent = `${state.daysLogged}/7`;
      document.getElementById('totalWeekPts').textContent = state.weekPoints.toFixed(1);

      // Insights summary
      document.getElementById('insightStreak').textContent = state.streak;
      document.getElementById('insightDays').textContent = state.daysLogged;

      // Best/worst habit
      const h = state.habits || {};
      let best = '-';
      let worst = '-';

      const scores = [];
      if (h.sleep != null) scores.push({ name: 'Sleep', value: h.sleep });
      if (h.study != null) scores.push({ name: 'Study', value: h.study });
      if (h.exercise != null) scores.push({ name: 'Exercise', value: h.exercise });
      if (h.hydration != null) scores.push({ name: 'Hydration', value: h.hydration });
      if (h.nutrition != null) scores.push({ name: 'Nutrition', value: h.nutrition });

      if (scores.length > 0) {
        scores.sort((a, b) => b.value - a.value);
        best = scores[0].name;
        worst = scores[scores.length - 1].name;
      }

      document.getElementById('bestHabit').textContent = best;
      document.getElementById('worstHabit').textContent = worst;

      // Update button text (RESTORED!)
      const today = new Date().toISOString().split('T')[0];
      const logButton = document.querySelector('.submit-btn');
      if (state.lastLogDate === today) {
        logButton.innerHTML = 'Update Today\'s Habits';
      } else {
        logButton.innerHTML = 'Log Habits';
      }

      updateMatchup();
      updateMatchupPage();
      updateLeague();
      updateInsights();
    }

    function updateMatchup() {
      const isWinning = state.matchup.userScore >= state.matchup.oppScore;
      const fullCard = document.getElementById('fullMatchCard');
      if (!fullCard) return;

      fullCard.innerHTML = `
        <div class="matchup-header">
          <span class="week-badge">Week ${state.matchup.week}</span>
          <span style="color: var(--electric-purple); font-size: 1.25rem;">‚öîÔ∏è</span>
          <span class="status-badge ${isWinning ? 'winning' : 'losing'}">
            ${isWinning ? 'Winning' : 'Losing'}
          </span>
        </div>
        <div class="scoreboard">
          <div class="player-score user ${isWinning ? 'leading' : ''}">
            <span class="player-name">${state.user.name}</span>
            <span class="score">${state.matchup.userScore.toFixed(1)}</span>
            <span class="score-label">points</span>
          </div>
          <div class="vs-divider"><span>VS</span></div>
          <div class="player-score opponent ${!isWinning ? 'leading' : ''}">
            <span class="player-name">${state.matchup.opponent}</span>
            <span class="score">${state.matchup.oppScore}</span>
            <span class="score-label">points</span>
          </div>
        </div>
      `;
    }

    function updateMatchupPage() {
      // Update matchup page elements
      document.getElementById('matchupWeek').textContent = state.matchup.week;
      document.getElementById('matchupUserName').textContent = state.user.name;
      document.getElementById('matchupOppName').textContent = state.matchup.opponent;
      document.getElementById('matchupUserScore').textContent = state.matchup.userScore.toFixed(1);
      document.getElementById('matchupOppScore').textContent = state.matchup.oppScore;

      const isWinning = state.matchup.userScore >= parseFloat(state.matchup.oppScore);
      const statusBadge = document.getElementById('matchupStatus');
      statusBadge.className = `status-badge ${isWinning ? 'winning' : 'losing'}`;
      statusBadge.textContent = isWinning ? 'Winning' : 'Losing';

      // Update score cards
      const userCard = document.getElementById('userScoreCard');
      const oppCard = document.getElementById('oppScoreCard');
      if (isWinning) {
        userCard.classList.add('leading');
        oppCard.classList.remove('leading');
      } else {
        userCard.classList.remove('leading');
        oppCard.classList.add('leading');
      }

      // Update category breakdown
      const categories = [
        { icon: 'üò¥', name: 'Sleep', key: 'sleep' },
        { icon: 'üìö', name: 'Study', key: 'study' },
        { icon: 'üèãÔ∏è', name: 'Exercise', key: 'exercise' },
        { icon: 'üíß', name: 'Hydration', key: 'hydration' },
        { icon: 'üçé', name: 'Nutrition', key: 'nutrition' }
      ];

      const breakdownHTML = categories.map(cat => {
        const userVal = state.matchup.categories[cat.key].user || 0;
        const oppVal = state.matchup.categories[cat.key].opp || 0;
        const total = userVal + oppVal;
        const userPercent = total > 0 ? (userVal / total * 100) : 50;

        return `
          <div class="category-item">
            <div class="category-header">
              <span class="category-name">${cat.icon} ${cat.name}</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${userPercent}%;"></div>
            </div>
            <div class="category-scores">
              <span class="you">You: ${userVal.toFixed(1)}</span>
              <span class="them">Them: ${oppVal.toFixed(1)}</span>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('categoryBreakdown').innerHTML = breakdownHTML;
    }

    function updateLeague() {
      const leagueNameEl = document.getElementById('leagueName');
      const inviteCodeEl = document.getElementById('inviteCode');
      const playerCountEl = document.getElementById('playerCount');
      const tbody = document.getElementById('standingsBody');

      if (!leagueNameEl || !inviteCodeEl || !playerCountEl || !tbody) return;

      leagueNameEl.textContent = state.league.name;
      inviteCodeEl.textContent = state.league.code;
      playerCountEl.textContent = `üë• ${state.league.players.length} Players`;

      if (!state.league.players.length) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align:center; padding: 20px;">
              No players yet. Create or join a league!
            </td>
          </tr>
        `;
        return;
      }

      // Sort players by wins (desc), then total points (desc)
      const sortedPlayers = [...state.league.players].sort((a, b) => {
        if (b.wins !== a.wins) return b.wins - a.wins;
        return b.total_points - a.total_points;
      });

      tbody.innerHTML = sortedPlayers.map((p, i) => {
        const rankIcon =
          i === 0 ? '<span class="gold">üèÜ</span>' :
            i === 1 ? '<span class="silver">ü•à</span>' :
              i === 2 ? '<span class="bronze">ü•â</span>' :
                `<span style="font-family: var(--font-mono); color: var(--text-muted);">${i + 1}</span>`;

        const isUser = currentUser && p.player_id === currentUser._id;

        return `
          <tr class="${isUser ? 'current-user' : ''}">
            <td class="rank-cell">${rankIcon}</td>
            <td class="name-cell">
              <span>${p.name}</span>
              ${isUser ? '<span class="you-badge">You</span>' : ''}
            </td>
            <td class="stat-cell wins">${p.wins}</td>
            <td class="stat-cell losses">${p.losses}</td>
            <td class="stat-cell points">${p.total_points.toFixed(1)}</td>
            <td class="stat-cell">${p.current_week_score ? p.current_week_score.total.toFixed(1) : '0.0'}</td>
          </tr>
        `;
      }).join('');
    }

    function updateInsights() {
      const avgGrid = document.getElementById('averagesGrid');
      if (!avgGrid) return;

      const h = state.habits || {};
      const items = [
        { key: 'sleep', label: 'Sleep (hrs)' },
        { key: 'study', label: 'Study (hrs)' },
        { key: 'exercise', label: 'Exercise (hrs)' },
        { key: 'hydration', label: 'Hydration (cups)' },
        { key: 'nutrition', label: 'Nutrition (/10)' },
        { key: 'mindfulness', label: 'Mind (min)' }
      ];

      const cards = items
        .filter(item => h[item.key] != null)
        .map(item => `
          <div class="habit-field" style="background: var(--bg-elevated);">
            <div class="field-header">
              <label>${item.label}</label>
            </div>
            <div style="font-family:var(--font-display);font-size:1.3rem;">
              ${h[item.key]}
            </div>
          </div>
        `);

      if (!cards.length) {
        avgGrid.innerHTML = `
          <div style="color: var(--text-muted); font-size: 0.85rem;">
            Averages will show as you log more days.
          </div>
        `;
      } else {
        avgGrid.innerHTML = cards.join('');
      }
    }

    // ============ NAVIGATION ============
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

      const page = document.getElementById(pageId);
      if (page) page.classList.add('active');

      const link = document.querySelector(`.nav-link[data-page="${pageId}"]`);
      if (link) link.classList.add('active');

      // Update matchup page when opened
      if (pageId === 'matchup') {
        updateMatchupPage();
      }
    }

    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        const page = link.dataset.page;
        if (page) {
          e.preventDefault();
          showPage(page);
        }
      });
    });
  </script>
</body>

</html>
